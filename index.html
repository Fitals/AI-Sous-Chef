<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n-key="appTitle">CulinaryChat Pro - –í–∞—à –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∫—É—Ö–æ–Ω–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫</title>
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300;400;500;600;700&family=Nunito:wght@300;400;500;600;700;800&family=Kalam:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/components/modal.css">
    <link rel="stylesheet" href="css/components/profile.css">
    <link rel="stylesheet" href="css/dark-theme.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        .add-ingredient-btn {
            background-color: #28a745;
            color: white;
            padding: 15px 25px;
            border: none;
            border-radius: 20px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }
        .add-ingredient-btn:hover {
            background-color: #218838;
            transform: translateY(-2px);
        }
        .add-ingredient-btn:active {
            transform: translateY(0);
        }
    </style>
</head>
<body>
    <!-- –ú–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é -->
    <button class="mobile-menu-toggle" id="mobileMenuToggle">
        <i class="fas fa-bars"></i>
    </button>

    <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo" data-i18n-key="sidebar_logo_title">
                <i class="fas fa-utensils"></i> CulinaryChat Pro
            </div>
            <div class="sidebar-subtitle" data-i18n-key="sidebar_logo_subtitle">–í–∞—à –∫—É—Ö–æ–Ω–Ω—ã–π –≥—É—Ä—É</div>
        </div>

        <nav class="nav-menu">
            <div class="nav-section-title" data-i18n-key="nav_main">–ì–ª–∞–≤–Ω–æ–µ</div>
            
            <div class="nav-item">
                <a href="#" class="nav-link active" data-section="chat">
                    <i class="fas fa-comments"></i>
                    <span data-i18n-key="nav_chat">–ß–∞—Ç —Å –ø–æ–º–æ—â–Ω–∏–∫–æ–º</span>
                </a>
            </div>

            <div class="nav-item">
                <a href="#" class="nav-link" data-section="ingredients">
                    <i class="fas fa-seedling"></i>
                    <span data-i18n-key="nav_ingredients">–ö–ª–∞–¥–æ–≤–∞—è –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤</span>
                    <span class="nav-badge" id="ingredientsCount">0</span>
                </a>
            </div>

            <div class="nav-item">
                <a href="#" class="nav-link" data-section="profile">
                    <i class="fas fa-user-chef"></i>
                    <span data-i18n-key="nav_profile">–ü—Ä–æ—Ñ–∏–ª—å</span>
                </a>
            </div>

            <div class="nav-section-title" data-i18n-key="nav_my_recipes">–ú–æ–∏ —Ä–µ—Ü–µ–ø—Ç—ã</div>
            
            <div class="nav-item">
                <a href="#" class="nav-link" data-section="favorites">
                    <i class="fas fa-heart"></i>
                    <span data-i18n-key="nav_favorites">–ò–∑–±—Ä–∞–Ω–Ω—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã</span>
                    <span class="nav-badge" id="favoritesCount">0</span>
                </a>
            </div>

            <div class="nav-section-title" data-i18n-key="nav_tools">–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</div>

            <div class="nav-item">
                <a href="#" class="nav-link" data-section="timers">
                    <i class="fas fa-stopwatch"></i>
                    <span data-i18n-key="nav_timers">–ö—É–ª–∏–Ω–∞—Ä–Ω—ã–µ —Ç–∞–π–º–µ—Ä—ã</span>
                    <span class="nav-badge" id="timersCount">0</span>
                </a>
            </div>
        </nav>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="main-content" id="mainContent">
        <!-- –®–∞–ø–∫–∞ -->
        <div class="content-header">
            <h1 class="header-title" id="headerTitle">
                <i class="fas fa-comments"></i> <span data-i18n-key="header_title_chat">–ß–∞—Ç —Å –∫—É–ª–∏–Ω–∞—Ä–Ω—ã–º –ø–æ–º–æ—â–Ω–∏–∫–æ–º</span>
            </h1>
            <p class="header-subtitle" id="headerSubtitle" data-i18n-key="header_subtitle_chat">
                –ü–æ–ª—É—á–∏—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∏ —Ä–µ—Ü–µ–ø—Ç—ã –æ—Ç –ò–ò-–ø–æ–≤–∞—Ä–∞
            </p>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ -->
        <div class="content-body">
            
            <!-- –°–ï–ö–¶–ò–Ø –ß–ê–¢–ê -->
            <div class="content-section active" id="chat-section">
                <div class="chat-section active">
                    <!-- –ß–∞—Ç -->
                    <div class="chat-area">
                        <div class="messages-container" id="messagesContainer">
                            <div class="message bot initial-suggestions">
                                <div class="message-content">
                                    <div class="message-icon">
                                        <i class="fas fa-robot"></i>
                                    </div>
                                    <div class="message-text">
                                        <p class="message-title" data-i18n-key="chat_suggestion_title">–ß—Ç–æ –ø—Ä–∏–≥–æ—Ç–æ–≤–∏–º —Å–µ–≥–æ–¥–Ω—è?</p>
                                        <div class="suggestions-area" id="suggestionsArea">
                                            <div class="suggestions-grid">
                                                <div class="suggestion-card" data-i18n-prompt-key="prompt_breakfast">
                                                    <div class="suggestion-emoji">ü•û</div>
                                                    <div class="suggestion-title" data-i18n-key="suggestion_breakfast_title">–ë—ã—Å—Ç—Ä—ã–π –∑–∞–≤—Ç—Ä–∞–∫</div>
                                                    <div class="suggestion-subtitle" data-i18n-key="suggestion_breakfast_subtitle">15-20 –º–∏–Ω—É—Ç</div>
                                                </div>
                                                <div class="suggestion-card" data-i18n-prompt-key="prompt_dinner">
                                                    <div class="suggestion-emoji">üïØÔ∏è</div>
                                                    <div class="suggestion-title" data-i18n-key="suggestion_dinner_title">–†–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π —É–∂–∏–Ω</div>
                                                    <div class="suggestion-subtitle" data-i18n-key="suggestion_dinner_subtitle">–û—Å–æ–±—ã–π —Å–ª—É—á–∞–π</div>
                                                </div>
                                                <div class="suggestion-card" data-i18n-prompt-key="prompt_kids">
                                                    <div class="suggestion-emoji">üë∂</div>
                                                    <div class="suggestion-title" data-i18n-key="suggestion_kids_title">–î–µ—Ç—Å–∫–æ–µ –º–µ–Ω—é</div>
                                                    <div class="suggestion-subtitle" data-i18n-key="suggestion_kids_subtitle">–ü–æ–ª–µ–∑–Ω–æ –∏ –≤–∫—É—Å–Ω–æ</div>
                                                </div>
                                                <div class="suggestion-card" data-i18n-prompt-key="prompt_party">
                                                    <div class="suggestion-emoji">üéâ</div>
                                                    <div class="suggestion-title" data-i18n-key="suggestion_party_title">–ü—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–π —Å—Ç–æ–ª</div>
                                                    <div class="suggestion-subtitle" data-i18n-key="suggestion_party_subtitle">–í–ø–µ—á–∞—Ç–ª–∏—Ç—å –≥–æ—Å—Ç–µ–π</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="message bot">
                                <div class="message-content">
                                    <div class="message-icon">
                                        <i class="fas fa-robot"></i>
                                    </div>
                                    <div class="message-text">
                                        <span data-i18n-key="chat_welcome_title"><h3>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—É—é –∫—É—Ö–Ω—é!</h3></span>
                                        <span data-i18n-key="chat_welcome_text"><p>–Ø –≤–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –∫—É–ª–∏–Ω–∞—Ä–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫. –í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–Ω—É –∏–∑ –∏–¥–µ–π –≤—ã—à–µ, –æ–ø–∏—à–∏—Ç–µ –∂–µ–ª–∞–µ–º–æ–µ –±–ª—é–¥–æ –∏–ª–∏ –≤–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –∫–ª–∞–¥–æ–≤–æ–π –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤ –≤ –º–µ–Ω—é —Å–ª–µ–≤–∞.</p></span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –≥–æ—Ç–æ–≤–∫–∏ -->
                        <div class="cooking-indicator" id="cookingIndicator">
                            <div class="cooking-process">
                                <div class="cooking-pan">üç≥</div>
                                <div class="cooking-steam">
                                    <span class="steam-particle">üí®</span>
                                    <span class="steam-particle">üí®</span>
                                    <span class="steam-particle">üí®</span>
                                </div>
                                <div class="cooking-text" id="cookingText" data-i18n-key="cooking_indicator_text">–ì–æ—Ç–æ–≤–ª—é –≤–∞—à —Ä–µ—Ü–µ–ø—Ç...</div>
                            </div>
                            <div class="cooking-progress">
                                <div class="cooking-progress-bar"></div>
                            </div>
                        </div>

                        <!-- –ü–æ–ª–µ –≤–≤–æ–¥–∞ -->
                        <div class="input-container">
                            <input type="text" class="input-field" id="messageInput" 
                                   placeholder="–û–ø–∏—à–∏—Ç–µ, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å..." maxlength="500" data-i18n-key="chat_input_placeholder">
                            <button class="send-button">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –°–ï–ö–¶–ò–Ø –ò–ù–ì–†–ï–î–ò–ï–ù–¢–û–í -->
            <div class="content-section" id="ingredients-section">
                <div class="ingredients-layout">
                    <div class="ingredients-layout__left">
                        <div class="cooking-basket-container" id="cookingBasket">
                            <div class="basket-header">
                                <div class="basket-title">
                                    <i class="fas fa-shopping-basket"></i>
                                    <span data-i18n-key="ingredients_basket_title">–ö–æ—Ä–∑–∏–Ω–∞</span>
                                </div>
                                <div class="basket-subtitle" data-i18n-key="ingredients_basket_subtitle">–ì–æ—Ç–æ–≤–∏–º —Å –ò–ò</div>
                            </div>

                            <div class="selected-ingredients-list" id="selectedIngredientsList">
                                <div class="empty-state">
                                    <i class="fas fa-utensils"></i>
                                    <p data-i18n-key="ingredients_basket_empty_state">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–¥—É–∫—Ç—ã</p>
                                </div>
                            </div>

                            <div class="basket-actions">
                                <button class="cook-with-ingredients-btn" id="cookWithIngredientsBtn" onclick="cookWithSelectedIngredients()">
                                    <i class="fas fa-magic"></i>
                                    <span data-i18n-key="ingredients_cook_button">–ü—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å —Ä–µ—Ü–µ–ø—Ç</span>
                                </button>
                                <button class="clear-basket-btn" id="clearBasketBtn" onclick="clearSelectedIngredients()">
                                    <i class="fas fa-trash-alt"></i>
                                    <span data-i18n-key="ingredients_clear_button">–û—á–∏—Å—Ç–∏—Ç—å</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="ingredients-layout__main">
                    <div class="ingredients-header">
                        <div class="ingredients-search-bar">
                            <div class="search-input-container">
                                <i class="fas fa-search search-icon"></i>
                                    <input type="text" class="search-input" id="searchInput" placeholder="–ü–æ–∏—Å–∫ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤..." data-i18n-key="ingredients_search_placeholder">
                            </div>
                                <button class="add-ingredient-btn" onclick="openAddIngredientModal()">
                                    <i class="fas fa-plus"></i> <span data-i18n-key="ingredients_add_button">–î–æ–±–∞–≤–∏—Ç—å</span>
                            </button>
                        </div>

                        <div id="mobileDietaryFilters"></div>

                        <div class="category-tabs" id="categoryTabs">
                            <div class="category-tab active" data-category="all">
                                    <i class="fas fa-utensils"></i> <span data-i18n-key="category_all">–í—Å–µ</span>
                            </div>
                            <div class="category-tab" data-category="vegetables">
                                    <i class="fas fa-carrot"></i> <span data-i18n-key="category_vegetables">–û–≤–æ—â–∏</span>
                            </div>
                            <div class="category-tab" data-category="meat">
                                    <i class="fas fa-drumstick-bite"></i> <span data-i18n-key="category_meat">–ú—è—Å–æ</span>
                            </div>
                            <div class="category-tab" data-category="dairy">
                                    <i class="fas fa-cheese"></i> <span data-i18n-key="category_dairy">–ú–æ–ª–æ—á–Ω–æ–µ</span>
                            </div>
                            <div class="category-tab" data-category="grains">
                                    <i class="fas fa-wheat-awn"></i> <span data-i18n-key="category_grains">–ö—Ä—É–ø—ã</span>
                            </div>
                            <div class="category-tab" data-category="fruits">
                                    <i class="fas fa-apple-alt"></i> <span data-i18n-key="category_fruits">–§—Ä—É–∫—Ç—ã</span>
                            </div>
                            <div class="category-tab" data-category="spices">
                                    <i class="fas fa-pepper-hot"></i> <span data-i18n-key="category_spices">–°–ø–µ—Ü–∏–∏</span>
                            </div>
                        </div>
                    </div>

                        <div class="ingredients-grid-container">
                            <div class="ingredients-grid" id="ingredientsGrid">
                                <!-- –ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                            </div>
                            </div>
                        </div>

                    <div class="ingredients-layout__right">
                            <div class="filters-panel" id="filtersPanel">
                                <!-- –ü–∞–Ω–µ–ª—å –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ –±—É–¥–µ—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω–∞ —Å—é–¥–∞ -->
                            </div>
                                    </div>
                </div>
            </div>

            <!-- –°–ï–ö–¶–ò–Ø –ü–†–û–§–ò–õ–Ø -->
            <div class="content-section" id="profile-section">
                <div class="profile-section">
                    <div class="profile-card">
                        <h2>
                            <span class="icon"><i class="fas fa-user-cog"></i></span>
                            <span data-i18n-key="profile_title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è</span>
                        </h2>
                        <p data-i18n-key="profile_subtitle">–£–ø—Ä–∞–≤–ª—è–π—Ç–µ –≤–∞—à–∏–º–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏.</p>

                        <div class="form-group">
                            <label for="apiKeyInput" data-i18n-key="profile_api_key_label">API-–∫–ª—é—á –¥–ª—è Gemini</label>
                            <div class="input-wrapper">
                                <i class="fas fa-key input-icon"></i>
                                <input type="password" id="apiKeyInput" class="api-key-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à API-–∫–ª—é—á" data-i18n-key="profile_api_key_placeholder">
                        </div>
                            <div id="apiKeyStatus"></div>
                        </div>
                        
                        <div class="api-key-actions">
                            <button class="save-api-key-btn" id="saveApiKeyBtn">
                                <span class="icon"><i class="fas fa-check-circle"></i></span>
                                <span data-i18n-key="profile_apply_button">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</span>
                            </button>
                             <button class="delete-api-key-btn" id="deleteApiKeyBtn">
                                <span class="icon"><i class="fas fa-trash-alt"></i></span>
                                <span data-i18n-key="profile_delete_button">–£–¥–∞–ª–∏—Ç—å</span>
                            </button>
                        </div>

                    </div>
                </div>
            </div>

            <!-- –°–ï–ö–¶–ò–Ø –ò–ó–ë–†–ê–ù–ù–û–ì–û -->
            <div class="content-section" id="favorites-section">
                <div class="favorites-section">
                     <div class="favorites-header" style="display: flex; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
                        <div class="favorites-search-container" style="flex-grow: 1; position: relative;">
                             <i class="fas fa-search" style="position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #9ca3af;"></i>
                             <input type="text" class="favorites-search" id="favoritesSearch" placeholder="–ü–æ–∏—Å–∫ –≤ –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö —Ä–µ—Ü–µ–ø—Ç–∞—Ö..." data-i18n-key="favorites_search_placeholder" style="width: 100%; padding: 10px 15px 10px 40px; border-radius: 20px; border: 1px solid #e5e7eb; background-color: #f9fafb;">
                        </div>
                        <div class="favorites-sort-container" style="display: flex; align-items: center; gap: 8px; color: #6b7280; background-color: #f9fafb; padding: 10px 15px; border-radius: 20px; border: 1px solid #e5e7eb;">
                            <i class="fas fa-sort-amount-down"></i>
                            <span data-i18n-key="favorites_sort_by_date">–ü–æ –¥–∞—Ç–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è</span>
                        </div>
                    </div>
                    <div class="favorites-grid" id="favoritesGrid">
                         <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ -->
                    </div>
                    <div class="empty-state empty-state-favorites" id="emptyFavorites">
                        <i class="fas fa-heart"></i>
                        <span data-i18n-key="favorites_empty_title"><h3>–ü–æ–∫–∞ –Ω–µ—Ç –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö —Ä–µ—Ü–µ–ø—Ç–æ–≤</h3></span>
                        <span data-i18n-key="favorites_empty_text"><p>–î–æ–±–∞–≤–ª—è–π—Ç–µ –ø–æ–Ω—Ä–∞–≤–∏–≤—à–∏–µ—Å—è —Ä–µ—Ü–µ–ø—Ç—ã –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ, –∏ –æ–Ω–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å</p></span>
                    </div>
                </div>
            </div>

            <!-- –°–ï–ö–¶–ò–Ø –¢–ê–ô–ú–ï–†–û–í -->
            <div class="content-section" id="timers-section">
                <div class="timers-section">
                    <div class="timers-header">
                        <div class="timers-title-container">
                             <h2 style="font-family: 'Comfortaa', cursive; font-size: 1.5rem; font-weight: 700; color: #374151;" data-i18n-key="timers_title">–ö—É–ª–∏–Ω–∞—Ä–Ω—ã–µ —Ç–∞–π–º–µ—Ä—ã</h2>
                             <p style="color: #6b7280; font-size: 0.95rem;" data-i18n-key="timers_subtitle">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–π—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –≥–æ—Ç–æ–≤–∫–∏</p>
                        </div>
                        <button class="add-timer-btn" onclick="addTimer()">
                            <i class="fas fa-plus"></i>
                            <span data-i18n-key="timers_add_button">–î–æ–±–∞–≤–∏—Ç—å —Ç–∞–π–º–µ—Ä</span>
                        </button>
                    </div>
                    <div class="timers-grid" id="timersGrid">
                        <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ —Ç–∞–π–º–µ—Ä–æ–≤ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å—é–¥–∞ -->
                    </div>
                    <div id="emptyTimers" class="empty-state" style="display: none;">
                        <i class="fas fa-stopwatch"></i>
                        <span data-i18n-key="timers_empty_title"><h3>–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç–∞–π–º–µ—Ä–æ–≤</h3></span>
                        <span data-i18n-key="timers_empty_text"><p>–ù–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å —Ç–∞–π–º–µ—Ä", —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –æ—Ç—Å—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏.</p></span>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script src="js/localization.js"></script>
    <script>
        // ===== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø =====
        const API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent';

        // ===== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï =====
        let currentSection = 'chat';
        let currentMessages = [];
        let currentChatId = null;
        let chatHistory = [];
        let userProfile = {
            name: '–ö—É–ª–∏–Ω–∞—Ä',
            level: 'beginner'
        };
        let timers = [];

        // ===== –°–ò–°–¢–ï–ú–ê –ò–ù–ì–†–ï–î–ò–ï–ù–¢–û–í =====
        let selectedIngredients = [];
        let currentCategory = 'all';
        let filteredIngredients = [];

        // –°–ø–∏—Å–æ–∫ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª ingredients-data.js
        // –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏

        // ===== –≠–õ–ï–ú–ï–ù–¢–´ DOM =====
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('mainContent');
        const mobileMenuToggle = document.getElementById('mobileMenuToggle');
        const messagesContainer = document.getElementById('messagesContainer');
        const messageInput = document.getElementById('messageInput');
        const cookingIndicator = document.getElementById('cookingIndicator');
        const cookingText = document.getElementById('cookingText');
        const headerTitle = document.getElementById('headerTitle');
        const headerSubtitle = document.getElementById('headerSubtitle');
        const suggestionsArea = document.getElementById('suggestionsArea');

        // –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤
        const ingredientsGrid = document.getElementById('ingredientsGrid');
        const searchInput = document.getElementById('searchInput');
        const categoryTabs = document.getElementById('categoryTabs');
        const selectedIngredientsList = document.getElementById('selectedIngredientsList');
        const cookingBasket = document.getElementById('cookingBasket');
        const cookWithIngredientsBtn = document.getElementById('cookWithIngredientsBtn');
        const clearBasketBtn = document.getElementById('clearBasketBtn');

        // –≠–ª–µ–º–µ–Ω—Ç—ã —Ç–∞–π–º–µ—Ä–æ–≤
        const timersGrid = document.getElementById('timersGrid');
        const emptyTimers = document.getElementById('emptyTimers');

        // ===== –ú–ê–°–°–ò–í–´ –î–ê–ù–ù–´–• =====
        const cookingPhrases = [
            "–ò–∑—É—á–∞—é –≤–∞—à–∏ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã...",
            "–ü–æ–¥–±–∏—Ä–∞—é –∏–¥–µ–∞–ª—å–Ω–æ–µ —Å–æ—á–µ—Ç–∞–Ω–∏–µ...",
            "–†–∞—Å—Å—á–∏—Ç—ã–≤–∞—é –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏...",
            "–°–æ–∑–¥–∞—é —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Ä–µ—Ü–µ–ø—Ç...",
            "–î–æ–±–∞–≤–ª—è—é —Å–µ–∫—Ä–µ—Ç–Ω—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏...",
            "–ü—Ä–æ–≤–µ—Ä—è—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –ø—Ä–æ–¥—É–∫—Ç–æ–≤...",
            "–î–æ–±–∞–≤–ª—è—é —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ —à—Ç—Ä–∏—Ö–∏...",
            "–í–∞—à —Ä–µ—Ü–µ–ø—Ç –≥–æ—Ç–æ–≤!"
        ];

        // ===== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø =====
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            console.log('üç≥ CulinaryChat Pro –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è...');
            
            loadUserData();
            initializeNavigation();
            initializeMobileMenu();
            initializeIngredients();
            initializeSuggestions();
            initializeTimers();
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫
            navigateTo('chat');

            updateBadges();
            console.log('‚úÖ CulinaryChat Pro –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!');
        }

        // ===== –ù–ê–í–ò–ì–ê–¶–ò–Ø =====
        function initializeNavigation() {
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const section = link.dataset.section;
                    navigateTo(section, link);
                });
            });
        }

        function navigateTo(section, activeLink = null) {
            currentSection = section;

            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            
            const targetSection = document.getElementById(`${section}-section`);
            if (targetSection) {
                targetSection.classList.add('active');
            }

            if (activeLink) {
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                activeLink.classList.add('active');
            } else {
                const link = document.querySelector(`.nav-link[data-section="${section}"]`);
                if (link) {
                    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                    link.classList.add('active');
                }
            }
            updateHeaderForSection(section);
        }

        function updateHeaderForSection(section) {
            const headerData = {
                chat: { icon: 'fa-comments', title: 'header_title_chat', subtitle: 'header_subtitle_chat' },
                ingredients: { icon: 'fa-seedling', title: 'header_title_ingredients', subtitle: 'header_subtitle_ingredients' },
                profile: { icon: 'fa-user-chef', title: 'header_title_profile', subtitle: 'header_subtitle_profile' },
                favorites: { icon: 'fa-heart', title: 'header_title_favorites', subtitle: 'header_subtitle_favorites' },
                timers: { icon: 'fa-stopwatch', title: 'header_title_timers', subtitle: 'header_subtitle_timers' }
            };
            
            const data = headerData[section] || { icon: 'fa-question-circle', title: '', subtitle: '' };

            headerTitle.innerHTML = `<i class="fas ${data.icon}"></i> <span data-i18n-key="${data.title}"></span>`;
            headerSubtitle.setAttribute('data-i18n-key', data.subtitle);

            if (typeof applyTranslations === 'function') {
                applyTranslations(getLanguage());
            }
        }

        // ===== –ú–û–ë–ò–õ–¨–ù–û–ï –ú–ï–ù–Æ =====
        function initializeMobileMenu() {
            mobileMenuToggle.addEventListener('click', () => {
                sidebar.classList.toggle('mobile-open');
            });

            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
            document.addEventListener('click', (e) => {
                if (window.innerWidth <= 768 && 
                    !sidebar.contains(e.target) && 
                    !mobileMenuToggle.contains(e.target)) {
                    sidebar.classList.remove('mobile-open');
                }
            });
        }

        // ===== –°–ò–°–¢–ï–ú–ê –ò–ù–ì–†–ï–î–ò–ï–ù–¢–û–í =====
        function initializeIngredients() {
            filteredIngredients = [...availableIngredients];
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞
            searchInput.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase();
                filterIngredients(query, currentCategory);
            });

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∫–ª–∞–¥–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
            categoryTabs.addEventListener('click', (e) => {
                const tab = e.target.closest('.category-tab');
                if (!tab) return;

                document.querySelectorAll('.category-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');

                currentCategory = tab.dataset.category;
                filterIngredients(searchInput.value.toLowerCase(), currentCategory);
            });

            displayIngredients();
        }

        function displayIngredients() {
            ingredientsGrid.innerHTML = '';
            
            if (filteredIngredients.length === 0) {
                ingredientsGrid.innerHTML = `
                    <div class="empty-ingredients">
                        <i class="fas fa-search"></i>
                        <h3>–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                        <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å</p>
                    </div>
                `;
                return;
            }

            filteredIngredients.forEach((ingredient, index) => {
                const ingredientDiv = document.createElement('div');
                ingredientDiv.className = 'ingredient-item';
                if (ingredient.seasonal) {
                    ingredientDiv.classList.add('seasonal');
                }
                ingredientDiv.setAttribute('data-id', ingredient.id);
                
                const isSelected = selectedIngredients.find(item => item.id === ingredient.id);
                if (isSelected) {
                    ingredientDiv.classList.add('selected');
                }
                
                ingredientDiv.innerHTML = `
                    <div class="ingredient-emoji">${ingredient.emoji}</div>
                    <div class="ingredient-name">${ingredient.name}</div>
                    <div class="ingredient-category">${getCategoryName(ingredient.category)}</div>
                `;
                
                ingredientDiv.addEventListener('click', () => {
                    toggleIngredient(ingredient, ingredientDiv);
                });
                
                ingredientsGrid.appendChild(ingredientDiv);
                
                // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
                setTimeout(() => {
                    ingredientDiv.classList.add('landed');
                }, (index * 50) + 100);
            });
        }

        function filterIngredients(query, category) {
            const searchTerms = query.toLowerCase().split(' ').filter(term => term.length > 1);

            // –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–æ–∏—Å–∫—É –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            const baseFiltered = availableIngredients.filter(ingredient => {
                const matchesCategory = category === 'all' || ingredient.category === category;
                if (!matchesCategory) {
                    return false;
                }

                if (query.trim() === '') {
                    return true;
                }
                
                const ingredientNameWords = ingredient.name.toLowerCase().split(' ');

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–∏ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç –ö–ê–ñ–î–û–ú–£ –ø–æ–∏—Å–∫–æ–≤–æ–º—É —Å–ª–æ–≤—É
                const matchesSearch = searchTerms.every(searchTerm => {
                    // –°–Ω–∞—á–∞–ª–∞ –∏—â–µ–º –ø—Ä—è–º–æ–µ –≤—Ö–æ–∂–¥–µ–Ω–∏–µ (—ç—Ç–æ –±—ã—Å—Ç—Ä–µ–µ)
                    if (ingredient.name.toLowerCase().includes(searchTerm)) {
                        return true;
                    }

                    // –ï—Å–ª–∏ –ø—Ä—è–º–æ–≥–æ –≤—Ö–æ–∂–¥–µ–Ω–∏—è –Ω–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ–º "—É–º–Ω—ã–π" –ø–æ–∏—Å–∫
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –•–û–¢–Ø –ë–´ –û–î–ù–û —Å–ª–æ–≤–æ –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏, –ø–æ—Ö–æ–∂–µ–µ –Ω–∞ –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
                    return ingredientNameWords.some(ingWord => {
                        const distance = levenshteinDistance(searchTerm, ingWord);
                        // –ü–æ—Ä–æ–≥ –¥–ª—è –æ–ø–µ—á–∞—Ç–æ–∫: 1 –æ—à–∏–±–∫–∞ –Ω–∞ 4 —Å–∏–º–≤–æ–ª–∞, –Ω–æ –Ω–µ –±–æ–ª—å—à–µ 2-—Ö –æ—à–∏–±–æ–∫
                        const threshold = Math.min(2, Math.floor(ingWord.length / 4));
                        return distance <= threshold;
                    });
                });

                return matchesSearch;
            });
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –¥–∏–µ—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã, –µ—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
            filteredIngredients = typeof isIngredientCompatible === 'function' 
                ? baseFiltered.filter(isIngredientCompatible)
                : baseFiltered;

            displayIngredients();
        }

        function levenshteinDistance(a, b) {
            if (a.length === 0) return b.length;
            if (b.length === 0) return a.length;

            const matrix = [];

            for (let i = 0; i <= b.length; i++) {
                matrix[i] = [i];
            }

            for (let j = 0; j <= a.length; j++) {
                matrix[0][j] = j;
            }

            for (let i = 1; i <= b.length; i++) {
                for (let j = 1; j <= a.length; j++) {
                    if (b.charAt(i - 1) === a.charAt(j - 1)) {
                        matrix[i][j] = matrix[i - 1][j - 1];
                    } else {
                        matrix[i][j] = Math.min(
                            matrix[i - 1][j - 1] + 1, // –∑–∞–º–µ–Ω–∞
                            matrix[i][j - 1] + 1,     // –≤—Å—Ç–∞–≤–∫–∞
                            matrix[i - 1][j] + 1      // —É–¥–∞–ª–µ–Ω–∏–µ
                        );
                    }
                }
            }

            return matrix[b.length][a.length];
        }

        // –§—É–Ω–∫—Ü–∏—è getCategoryName –ø–µ—Ä–µ–º–µ—â–µ–Ω–∞ –≤ —Ñ–∞–π–ª ingredients-data.js

        function toggleIngredient(ingredient, element) {
            const existingIndex = selectedIngredients.findIndex(item => item.id === ingredient.id);
            
            if (existingIndex >= 0) {
                // –£–±–∏—Ä–∞–µ–º –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
                createDropAnimation(ingredient.emoji, element);
                selectedIngredients.splice(existingIndex, 1);
                element.classList.remove('selected');
            } else {
                // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç
                selectedIngredients.push({
                    ...ingredient,
                    quantity: 1,
                    unit: ingredient.units[0]
                });
                element.classList.add('selected');
            }
            
            updateSelectedIngredientsList();
            updateBadges();
        }

        function createDropAnimation(emoji, sourceElement) {
            const dropElement = document.createElement('div');
            dropElement.className = 'ingredient-drop-animation';
            dropElement.textContent = emoji;
            
            const rect = sourceElement.getBoundingClientRect();
            dropElement.style.left = rect.left + 'px';
            dropElement.style.top = rect.top + 'px';
            
            document.body.appendChild(dropElement);
            
            setTimeout(() => {
                dropElement.remove();
            }, 1500);
        }

        function updateIngredientUnit(ingredientId, newUnit) {
            const ingredient = selectedIngredients.find(item => item.id === ingredientId);
            if (ingredient) {
                ingredient.unit = newUnit;
            }
        }

        function updateIngredientQuantity(ingredientId, newQuantity) {
            const ingredient = selectedIngredients.find(item => item.id === ingredientId);
            const quantity = parseInt(newQuantity, 10);

            const inputElement = document.querySelector(`.selected-ingredient[data-id="${ingredientId}"] .quantity-input`);

            if (ingredient && quantity > 0) {
                ingredient.quantity = quantity;
            } else if (ingredient) {
                // –ï—Å–ª–∏ –≤–≤–µ–¥–µ–Ω–æ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞—Ä–æ–µ
                if(inputElement) inputElement.value = ingredient.quantity;
                showNotification('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –±–æ–ª—å—à–µ –Ω—É–ª—è', 'warning');
            }
        }

        let basketObserver;

        function updateSelectedIngredientsList() {
            const list = document.getElementById('selectedIngredientsList');
            if (!list) return;

            const cookingBasket = document.getElementById('cookingBasket');
            const cookWithIngredientsBtn = document.getElementById('cookWithIngredientsBtn');
            const clearBasketBtn = document.getElementById('clearBasketBtn');

            list.innerHTML = ''; // –û—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫

            if (selectedIngredients.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-utensils"></i>
                        <p data-i18n-key="ingredients_basket_empty_state">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–¥—É–∫—Ç—ã</p>
                    </div>
                `;
                cookingBasket.classList.remove('has-items');
                cookWithIngredientsBtn.classList.remove('show');
                clearBasketBtn.classList.remove('show');
                document.querySelector('.basket-title').innerHTML = `
                    <i class="fas fa-shopping-basket"></i>
                    –ö–æ—Ä–∑–∏–Ω–∞
                `;
            } else {
                selectedIngredients.forEach(ingredient => {
                    const unitsSelector = `
                        <select class="card-unit-selector" onchange="updateIngredientUnit('${ingredient.id}', this.value)" onclick="event.stopPropagation();">
                            ${ingredient.units.map(u => `<option value="${u}" ${u === ingredient.unit ? 'selected' : ''}>${u}</option>`).join('')}
                        </select>
                    `;

                    const cardHTML = `
                        <div class="selected-ingredient-card" data-id="${ingredient.id}">
                            <div class="card-inner">
                                <div class="card-front">
                                    <div class="card-emoji">${ingredient.emoji}</div>
                                    <div class="card-name">${ingredient.name}</div>
                                </div>
                                <div class="card-back">
                                    <button class="card-remove-btn" onclick="removeSelectedIngredient('${ingredient.id}'); event.stopPropagation();">
                                        <i class="fas fa-times"></i>
                                    </button>
                                    <div class="card-back-title">${ingredient.name}</div>
                                    <div class="card-controls">
                                        <input type="number" value="${ingredient.quantity}" min="1" class="card-quantity-input" 
                                               onchange="updateIngredientQuantity('${ingredient.id}', this.value)"
                                               onclick="event.stopPropagation();">
                                        ${unitsSelector}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    list.innerHTML += cardHTML;
                });
                
                cookingBasket.classList.add('has-items');
                cookWithIngredientsBtn.classList.add('show');
                clearBasketBtn.classList.add('show');
                
                document.querySelector('.basket-title').innerHTML = `
                    <i class="fas fa-shopping-basket"></i>
                    –í—ã–±—Ä–∞–Ω–æ: ${selectedIngredients.length}
                `;
            }

            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å—é –∫–æ—Ä–∑–∏–Ω—ã
            setupBasketObserver();
        }

        function setupBasketObserver() {
            const list = document.getElementById('selectedIngredientsList');
            if (!list) return;

            if (basketObserver) {
                basketObserver.disconnect();
            }

            basketObserver = new ResizeObserver(entries => {
                const entry = entries[0];
                const isOverflowing = entry.target.scrollHeight > entry.target.clientHeight;
                
                if (isOverflowing) {
                    entry.target.classList.add('is-crowded');
                } else {
                    entry.target.classList.remove('is-crowded');
                }
            });

            basketObserver.observe(list);
        }

        function removeSelectedIngredient(ingredientId) {
            selectedIngredients = selectedIngredients.filter(item => item.id !== ingredientId);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            const element = document.querySelector(`[data-id="${ingredientId}"]`);
            if (element) {
                element.classList.remove('selected');
            }
            
            updateSelectedIngredientsList();
            updateBadges();
        }

        function clearSelectedIngredients() {
            selectedIngredients = [];
            document.querySelectorAll('.ingredient-item').forEach(item => {
                item.classList.remove('selected');
            });
            updateSelectedIngredientsList();
            updateBadges();
        }

        function clearSearch() {
            searchInput.value = '';
            currentCategory = 'all';
            document.querySelectorAll('.category-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelector('[data-category="all"]').classList.add('active');
            filterIngredients('', 'all');
        }

        function cookWithSelectedIngredients() {
            if (selectedIngredients.length === 0) return;
            
            // –°–æ–∑–¥–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤
            const ingredientsList = selectedIngredients.map(ing => 
                `${ing.quantity} ${ing.unit} ${ing.name.toLowerCase()}`
            ).join(', ');
            
            const message = `–£ –º–µ–Ω—è –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ —ç—Ç–∏ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã: ${ingredientsList}. –ü—Ä–∏–≥–æ—Ç–æ–≤—å —Ä–µ—Ü–µ–ø—Ç –¢–û–õ–¨–ö–û –∏–∑ –Ω–∏—Ö, –±–µ–∑ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥—Ä—É–≥–∏—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤!`;
            
            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ —á–∞—Ç
            navigateTo('chat');
            hideSuggestions();
            
            setTimeout(() => {
                addUserMessage(message);
                setTimeout(() => {
                    generateRecipeResponse(message);
                }, 1000);
            }, 500);
        }

        // ===== –°–ò–°–¢–ï–ú–ê –ß–ê–¢–ê =====
        function selectSuggestion(suggestionText) {
            const suggestionsContainer = document.querySelector('.initial-suggestions');
            if (suggestionsContainer) {
                suggestionsContainer.style.display = 'none';
            }
            
            addUserMessage(suggestionText);
            setTimeout(() => {
                generateRecipeResponse(suggestionText);
            }, 1000);
        }

        function hideSuggestions() {
            const suggestionsContainer = document.querySelector('.initial-suggestions');
            if (suggestionsContainer) {
                suggestionsContainer.style.display = 'none';
            }
        }

        function showSuggestions() {
            const suggestionsContainer = document.querySelector('.initial-suggestions');
            if (suggestionsContainer) {
                suggestionsContainer.style.display = 'block';
            }
        }

        async function sendMessage() {
            const messageText = messageInput.value.trim();
            if (messageText.length === 0) return;

            addUserMessage(messageText);
            messageInput.value = '';
            showCookingIndicator();
            
            // --- –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è –ò–ò ---
            const systemPrompt = getTranslation('ai_system_prompt');
            const userProfileTitle = getTranslation('prompt_user_profile_title');
            const userNameLabel = getTranslation('prompt_user_name_label');
            const userLevelLabel = getTranslation('prompt_user_level_label');
            const translatedUserLevel = getTranslation(`profile_level_${userProfile.level}`);
            const chatContextTitle = getTranslation('prompt_chat_context_title');
            const userRole = getTranslation('prompt_user_role');
            const assistantRole = getTranslation('prompt_assistant_role');
            const newRequestLabel = getTranslation('prompt_new_request_label');
            
            const prompt = `
${systemPrompt}

${userProfileTitle}:
- ${userNameLabel}: ${userProfile.name}
- ${userLevelLabel}: ${translatedUserLevel}

${chatContextTitle}:
${currentMessages.map(m => `- ${m.type === 'user' ? userRole : assistantRole}: ${m.text}`).join('\n')}

${newRequestLabel}: ${messageText}
`;

            try {
                const botResponse = await callGeminiAPI(prompt);
                
                if (botResponse) {
                    addBotMessage(botResponse);
                }
                // –ï—Å–ª–∏ botResponse is null, –∑–Ω–∞—á–∏—Ç callGeminiAPI —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–ª –æ—à–∏–±–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–ª—é—á–∞)
                
            } catch (error) {
                console.error('Error sending message:', error);
                addBotMessage('–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –Ω–µ —É–¥–∞–ª–æ—Å—å —Å–≤—è–∑–∞—Ç—å—Å—è —Å –ò–ò-–ø–æ–≤–∞—Ä–æ–º. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞—à–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ç–∏ –∏–ª–∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
            } finally {
                hideCookingIndicator();
            }
        }

        function addUserMessage(message, saveToHistory = true) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message user';
            messageDiv.textContent = message;
            messagesContainer.appendChild(messageDiv);
            scrollToBottom();
            
            if (saveToHistory) {
                currentMessages.push({
                    type: 'user',
                    text: message,
                    timestamp: Date.now()
                });
            }
        }

        function addBotMessage(message, recipeData = null, saveToHistory = true) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message bot';
            messageDiv.innerHTML = formatMessage(message);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è —Ä–µ—Ü–µ–ø—Ç–æ–≤
            if (recipeData || message.includes('üçΩÔ∏è') || message.includes('–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã:')) {
                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'recipe-actions';
                
                actionsDiv.innerHTML = `
                    <button class="action-btn favorite" onclick="toggleFavorite(this, '${Date.now()}')">
                        <i class="fas fa-heart"></i> –í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
                    </button>
                `;
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Å–∏—Å—Ç–µ–º—É –æ—Ü–µ–Ω–æ–∫
                const ratingDiv = document.createElement('div');
                ratingDiv.className = 'star-rating';
                ratingDiv.innerHTML = `
                    <span>–û—Ü–µ–Ω–∏—Ç–µ —Ä–µ—Ü–µ–ø—Ç:</span>
                    ${[1,2,3,4,5].map(star => 
                        `<i class="fas fa-star star" onclick="rateRecipe('${Date.now()}', ${star})"></i>`
                    ).join('')}
                `;
                
                messageDiv.appendChild(actionsDiv);
                messageDiv.appendChild(ratingDiv);
            }
            
            messagesContainer.appendChild(messageDiv);
            scrollToBottom();
            
            if (saveToHistory) {
                currentMessages.push({
                    type: 'bot',
                    text: message,
                    recipeData: recipeData,
                    timestamp: Date.now()
                });
                
                setTimeout(() => {
                    saveCurrentChat();
                }, 1000);
            }
        }

        function showCookingProcess() {
            cookingIndicator.style.display = 'block';
            scrollToBottom();
            
            let phraseIndex = 0;
            const phraseInterval = setInterval(() => {
                if (phraseIndex < cookingPhrases.length) {
                    cookingText.textContent = cookingPhrases[phraseIndex];
                    phraseIndex++;
                } else {
                    clearInterval(phraseInterval);
                }
            }, 400);
        }

        function hideCookingProcess() {
            cookingIndicator.style.display = 'none';
        }

        async function generateRecipeResponse(userMessage) {
            showCookingProcess();

            try {
                const prompt = createStrictCulinaryPrompt(userMessage);
                const response = await callGeminiAPI(prompt);
                
                hideCookingProcess();
                
                if (response) {
                    const recipeData = extractRecipeData(response);
                    addBotMessage(response, recipeData);
                } else {
                    addBotMessage('–ò–∑–≤–∏–Ω–∏—Ç–µ, —É –º–µ–Ω—è –ø—Ä–æ–±–ª–µ–º—ã –Ω–∞ –∫—É—Ö–Ω–µ! üòÖ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                hideCookingProcess();
                addBotMessage('–ò–∑–≤–∏–Ω–∏—Ç–µ, —É –º–µ–Ω—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –Ω–µ–ø–æ–ª–∞–¥–∫–∏! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.');
            }
        }

        function createStrictCulinaryPrompt(userMessage) {
            const profile = userProfile;
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, —É–∫–∞–∑–∞–Ω—ã –ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã
            const hasOnlyIngredients = userMessage.toLowerCase().includes('—Ç–æ–ª—å–∫–æ') || 
                                     userMessage.toLowerCase().includes('–µ—Å—Ç—å —Ç–æ–ª—å–∫–æ') ||
                                     userMessage.toLowerCase().includes('—É –º–µ–Ω—è –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ') ||
                                     userMessage.toLowerCase().includes('–∏–∑ –Ω–∏—Ö');

            let basePrompt = `–¢—ã - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∫—É–ª–∏–Ω–∞—Ä–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –∏ —à–µ—Ñ-–ø–æ–≤–∞—Ä. 

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–ø–∏—Å–∞–ª: "${userMessage}"

–£—Ä–æ–≤–µ–Ω—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${profile.level}`;

            if (hasOnlyIngredients) {
                basePrompt += `

üö® –í–ê–ñ–ù–û–ï –ü–†–ê–í–ò–õ–û: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∫–∞–∑–∞–ª –ö–û–ù–ö–†–ï–¢–ù–´–ï –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã! 
‚ùå –ù–ï –î–û–ë–ê–í–õ–Ø–ô –Ω–∏–∫–∞–∫–∏—Ö –¥—Ä—É–≥–∏—Ö –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤, –∫—Ä–æ–º–µ —É–∫–∞–∑–∞–Ω–Ω—ã—Ö!
‚ùå –ù–ï –ø—Ä–µ–¥–ª–∞–≥–∞–π "–ø–æ –∂–µ–ª–∞–Ω–∏—é" –∏–ª–∏ "–¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –≤–∫—É—Å–∞"!
‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û —Ç–µ –ø—Ä–æ–¥—É–∫—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–µ—Ä–µ—á–∏—Å–ª–∏–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å!
‚úÖ –ï—Å–ª–∏ —á–µ–≥–æ-—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç (—Å–æ–ª—å, –ø–µ—Ä–µ—Ü, –º–∞—Å–ª–æ –¥–ª—è –∂–∞—Ä–∫–∏) - —É–∫–∞–∂–∏ —ç—Ç–æ –æ—Ç–¥–µ–ª—å–Ω–æ.`;
            }

            return basePrompt + `

–°–æ–∑–¥–∞–π –ü–û–î–†–û–ë–ù–´–ô —Ä–µ—Ü–µ–ø—Ç –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ñ–æ—Ä–º–∞—Ç–µ:

üçΩÔ∏è **–ù–ê–ó–í–ê–ù–ò–ï –ë–õ–Æ–î–ê**

üìù **–û–ø–∏—Å–∞–Ω–∏–µ:** –ö—Ä–∞—Ç–∫–æ–µ –∞–ø–ø–µ—Ç–∏—Ç–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

‚è∞ **–í—Ä–µ–º—è –≥–æ—Ç–æ–≤–∫–∏:** X –º–∏–Ω—É—Ç (–ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ) + Y –º–∏–Ω—É—Ç (–æ–±—â–µ–µ –≤—Ä–µ–º—è)

üë• **–ü–æ—Ä—Ü–∏–∏:** Z –ø–æ—Ä—Ü–∏–π

üõí **–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã:**
‚Ä¢ –¢–æ—á–Ω—ã–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤—Å–µ—Ö –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤${hasOnlyIngredients ? ' (–¢–û–õ–¨–ö–û –∏–∑ —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º!)' : ''}

üë®‚Äçüç≥ **–ü–æ—à–∞–≥–æ–≤–æ–µ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ:**
1. –ü–æ–¥—Ä–æ–±–Ω—ã–µ —á–µ—Ç–∫–∏–µ —à–∞–≥–∏
2. –° —É–∫–∞–∑–∞–Ω–∏–µ–º –≤—Ä–µ–º–µ–Ω–∏ –∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
3. –° —Å–æ–≤–µ—Ç–∞–º–∏ –ø–æ —Ç–µ—Ö–Ω–∏–∫–µ

üí° **–ü–æ–ª–µ–∑–Ω—ã–µ —Å–æ–≤–µ—Ç—ã:**
‚Ä¢ –ö–∞–∫ —É–ª—É—á—à–∏—Ç—å –≤–∫—É—Å
‚Ä¢ –í–∞—Ä–∏–∞–Ω—Ç—ã –ø–æ–¥–∞—á–∏
‚Ä¢ –°–µ–∫—Ä–µ—Ç—ã –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è

ü•ó **–ü–∏—â–µ–≤–∞—è —Ü–µ–Ω–Ω–æ—Å—Ç—å (–Ω–∞ –ø–æ—Ä—Ü–∏—é):**
–ö–∞–ª–æ—Ä–∏–∏: ~X –∫–∫–∞–ª | –ë–µ–ª–∫–∏: X–≥ | –ñ–∏—Ä—ã: X–≥ | –£–≥–ª–µ–≤–æ–¥—ã: X–≥

–ë—É–¥—å –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–º –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–º. ${hasOnlyIngredients ? '–°–¢–†–û–ì–û —Å–ª–µ–¥—É–π —Å–ø–∏—Å–∫—É –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤!' : ''}`;
        }

        async function callGeminiAPI(prompt) {
            const apiKey = localStorage.getItem('geminiApiKey');

            if (!apiKey) {
                addBotMessage('API-–∫–ª—é—á –¥–ª—è Gemini –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –¥–æ–±–∞–≤—å—Ç–µ –µ–≥–æ –≤ —Ä–∞–∑–¥–µ–ª–µ "–ü—Ä–æ—Ñ–∏–ª—å", —á—Ç–æ–±—ã —è –º–æ–≥ –ø–æ–º–æ—á—å –≤–∞–º —Å —Ä–µ—Ü–µ–ø—Ç–∞–º–∏.');
                hideCookingIndicator();
                // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É, –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É –ø—Ä–æ—Ñ–∏–ª—è
                // showSection('profile-section');
                return null;
            }

            const response = await fetch(`${API_URL}?key=${apiKey}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    contents: [{
                        parts: [{
                            text: prompt
                        }]
                    }],
                    generationConfig: {
                        temperature: 0.7,
                        topK: 30,
                        topP: 0.9,
                        maxOutputTokens: 1200,
                    }
                })
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();
             if (data.candidates && data.candidates[0].content && data.candidates[0].content.parts[0]) {
                return data.candidates[0].content.parts[0].text;
            } else {
                console.error("Unexpected API response structure:", data);
                addBotMessage("–ò–∑–≤–∏–Ω–∏—Ç–µ, —è –ø–æ–ª—É—á–∏–ª —Å—Ç—Ä–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å.");
                return null;
            }
        }

        function extractRecipeData(recipeText) {
            // –ò–∑–≤–ª–µ–∫–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ä–µ—Ü–µ–ø—Ç–∞
            const data = {
                title: '',
                time: '',
                servings: '',
                ingredients: [],
                steps: [],
                calories: 0,
                protein: 0,
                fat: 0,
                carbs: 0
            };

            // –ò–∑–≤–ª–µ–∫–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ
            const titleMatch = recipeText.match(/üçΩÔ∏è\s?\*\*(.*?)\*\*/);
            if (titleMatch) data.title = titleMatch[1];

            // –ò–∑–≤–ª–µ–∫–∞–µ–º –≤—Ä–µ–º—è
            const timeMatch = recipeText.match(/‚è∞.*?(\d+).*?–º–∏–Ω—É—Ç/);
            if (timeMatch) data.time = timeMatch[1];

            // –ò–∑–≤–ª–µ–∫–∞–µ–º –ø–æ—Ä—Ü–∏–∏
            const servingsMatch = recipeText.match(/üë•.*?(\d+).*?–ø–æ—Ä—Ü/);
            if (servingsMatch) data.servings = servingsMatch[1];

            return data;
        }

        function formatMessage(text) {
            return text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/^‚Ä¢ (.*$)/gim, '<li>$1</li>')
                .replace(/^(\d+)\. (.*$)/gim, '<li><strong>$1.</strong> $2</li>')
                .replace(/(<li>.*<\/li>)/gs, '<ul>$1</ul>')
                .replace(/\n\n/g, '<br><br>')
                .replace(/\n/g, '<br>');
        }

        function scrollToBottom() {
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ Enter
        messageInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // ===== –°–ò–°–¢–ï–ú–ê –ò–ó–ë–†–ê–ù–ù–û–ì–û =====
        function toggleFavorite(button, recipeId) {
            // –î–µ–ª–µ–≥–∏—Ä—É–µ–º –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ culinary-extensions.js
            if (window.toggleFavorite !== undefined && this !== window.toggleFavorite) {
                window.toggleFavorite(button, recipeId);
                return;
            }
            
            // –†–µ–∑–µ—Ä–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∏—Å—å
            if (button.classList.contains('active')) {
                button.classList.remove('active');
                button.innerHTML = '<i class="fas fa-heart"></i> –í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ';
                showNotification('–†–µ—Ü–µ–ø—Ç —É–¥–∞–ª–µ–Ω –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ', 'warning');
            } else {
                button.classList.add('active');
                button.innerHTML = '<i class="fas fa-heart"></i> –í –∏–∑–±—Ä–∞–Ω–Ω–æ–º';
                showNotification('–†–µ—Ü–µ–ø—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ!', 'success');
            }
        }

        function rateRecipe(recipeId, rating) {
            // –î–µ–ª–µ–≥–∏—Ä—É–µ–º –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ culinary-extensions.js
            if (window.rateRecipe !== undefined && this !== window.rateRecipe) {
                window.rateRecipe(recipeId, rating);
                return;
            }
            
            // –†–µ–∑–µ—Ä–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∏—Å—å
            const stars = event.target.parentElement.querySelectorAll('.star');
            stars.forEach((star, index) => {
                star.classList.toggle('active', index < rating);
            });
            
            showNotification(`–†–µ—Ü–µ–ø—Ç –æ—Ü–µ–Ω–µ–Ω –Ω–∞ ${rating} –∑–≤–µ–∑–¥!`, 'success');
        }

        // ===== –ü–†–û–§–ò–õ–¨ =====
        function saveProfile() {
            userProfile.name = document.getElementById('userName').value;
            userProfile.level = document.getElementById('cookingLevel').value;
            
            saveUserData();
            showNotification('–ü—Ä–æ—Ñ–∏–ª—å —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!', 'success');
        }

        // ===== –°–û–•–†–ê–ù–ï–ù–ò–ï –î–ê–ù–ù–´–• =====
        function saveUserData() {
            try {
                localStorage.setItem('culinaryChat_userProfile', JSON.stringify(userProfile));
                localStorage.setItem('culinaryChat_selectedIngredients', JSON.stringify(selectedIngredients));
                saveTimers();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:', error);
            }
        }

        function loadUserData() {
            try {
                const savedProfile = localStorage.getItem('culinaryChat_userProfile');
                if (savedProfile) {
                    userProfile = {...userProfile, ...JSON.parse(savedProfile)};
                }
                
                const savedIngredients = localStorage.getItem('culinaryChat_selectedIngredients');
                if (savedIngredients) {
                    selectedIngredients = JSON.parse(savedIngredients);
                }
                
                const savedHistory = localStorage.getItem('culinaryChat_history');
                if (savedHistory) {
                    chatHistory = JSON.parse(savedHistory);
                }
                loadTimers();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
            }
        }

        function saveChatHistory() {
            try {
                localStorage.setItem('culinaryChat_history', JSON.stringify(chatHistory));
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏:', error);
            }
        }

        // ===== –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø =====
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            const icons = {
                success: 'fas fa-check-circle',
                error: 'fas fa-exclamation-circle',
                warning: 'fas fa-exclamation-triangle',
                info: 'fas fa-info-circle'
            };
            
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 12px;">
                    <i class="${icons[type]}" style="font-size: 1.2rem;"></i>
                    <div>
                        <div style="font-weight: 600; margin-bottom: 2px;">${getNotificationTitle(type)}</div>
                        <div style="font-size: 0.9rem; opacity: 0.9;">${message}</div>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="background: none; border: none; color: inherit; font-size: 1.1rem; cursor: pointer; margin-left: auto;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }

        function getNotificationTitle(type) {
            const titles = {
                success: '–£—Å–ø–µ—à–Ω–æ!',
                error: '–û—à–∏–±–∫–∞!',
                warning: '–í–Ω–∏–º–∞–Ω–∏–µ!',
                info: '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è'
            };
            return titles[type] || '–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ';
        }

        // ===== –û–ë–ù–û–í–õ–ï–ù–ò–ï –°–ß–ï–¢–ß–ò–ö–û–í =====
        function updateBadges() {
            const ingredientsCount = document.getElementById('ingredientsCount');
            const favoritesCount = document.getElementById('favoritesCount');
            const timersCount = document.getElementById('timersCount');
            
            if (ingredientsCount) {
                ingredientsCount.textContent = selectedIngredients.length;
                ingredientsCount.style.display = selectedIngredients.length > 0 ? 'inline-block' : 'none';
            }
            
            if (favoritesCount) {
                favoritesCount.style.display = 'none';
            }
            
            if (timersCount) {
                const activeTimers = timers.filter(t => t.isRunning).length;
                timersCount.textContent = activeTimers;
                timersCount.style.display = activeTimers > 0 ? 'inline-block' : 'none';
            }
        }

        // ===== –ê–í–¢–û–°–û–•–†–ê–ù–ï–ù–ò–ï =====
        setInterval(() => {
            saveUserData();
        }, 30000); // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥

        // ===== –û–ë–†–ê–ë–û–¢–ö–ê –ó–ê–ö–†–´–¢–ò–Ø –°–¢–†–ê–ù–ò–¶–´ =====
        window.addEventListener('beforeunload', () => {
            saveUserData();
        });

        console.log('üéâ CulinaryChat Pro –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω! –í–µ—Ä—Å–∏—è 2.1');

        // –§–£–ù–ö–¶–ò–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ö–û–†–ó–ò–ù–û–ô
        // ======================================

        function openCustomIngredientModal() {
            const searchInput = document.getElementById('searchInput');
            const modalNameInput = document.getElementById('customIngredientName');
            if (modalNameInput && searchInput) {
                modalNameInput.value = searchInput.value;
            }

            const modal = document.getElementById('addCustomIngredientModal');
            if (modal) {
                modal.classList.add('visible');
            }
        }

        function closeCustomIngredientModal() {
            const modal = document.getElementById('addCustomIngredientModal');
            modal.classList.remove('visible');
        }

        function submitCustomIngredient() {
            const nameInput = document.getElementById('customIngredientName');
            const descriptionInput = document.getElementById('customIngredientDescription');

            const customName = nameInput.value.trim();
            const customDescription = descriptionInput.value.trim();

            if (customName.length < 2) {
                showNotification('–ù–∞–∑–≤–∞–Ω–∏–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –¥–ª–∏–Ω–Ω–µ–µ', 'warning');
                return;
            }

            const alreadyExists = selectedIngredients.some(ing => ing.name.toLowerCase() === customName.toLowerCase());
            if (alreadyExists) {
                showNotification('–≠—Ç–æ—Ç –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç —É–∂–µ –≤ –∫–æ—Ä–∑–∏–Ω–µ', 'info');
                return;
            }

            const newIngredient = {
                id: 'custom_' + customName.toLowerCase().replace(/\s+/g, '_'),
                name: customName,
                description: customDescription,
                emoji: 'üìù',
                category: 'custom',
                units: ['—à—Ç', '–≥', '–∫–≥', '–º–ª', '–ª'],
                quantity: 1,
                unit: '—à—Ç'
            };

            selectedIngredients.push(newIngredient);
            updateSelectedIngredientsList();
            updateBadges();
            
            showNotification(`'${customName}' –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É`, 'success');
            
            // –û—á–∏—Å—Ç–∫–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–µ
            nameInput.value = '';
            descriptionInput.value = '';
            closeCustomIngredientModal();
            document.getElementById('searchInput').value = '';
        }

        function addToBasket(ingredientId) {
            const ingredient = ingredientsData.find(ing => ing.id === ingredientId);
            if (!ingredient) return;

            const alreadyExists = selectedIngredients.some(ing => ing.id === ingredientId);
            if (alreadyExists) {
                const item = selectedIngredients.find(ing => ing.id === ingredientId);
                item.quantity++;
                showNotification(`'${ingredient.name}' —É–∂–µ –≤ –∫–æ—Ä–∑–∏–Ω–µ. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–≤–µ–ª–∏—á–µ–Ω–æ.`, 'info');
            } else {
                selectedIngredients.push({ ...ingredient, quantity: 1, unit: ingredient.units[0] });
                showNotification(`'${ingredient.name}' –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É!`, 'success');
            }
            updateSelectedIngredientsList();
            updateBadges();
        }

        // ===== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–û–î–°–ö–ê–ó–û–ö =====
        function initializeSuggestions() {
            const suggestionCards = document.querySelectorAll('.suggestion-card');
            suggestionCards.forEach(card => {
                // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫, –µ—Å–ª–∏ –æ–Ω –±—ã–ª
                card.onclick = null;
                card.addEventListener('click', () => {
                    const promptKey = card.dataset.i18nPromptKey;
                    if (promptKey && typeof getTranslation === 'function') {
                        const translatedPrompt = getTranslation(promptKey);
                        selectSuggestion(translatedPrompt);
                    }
                });
            });
        }
    </script>
    <script src="ingredients-data.js"></script>
    <script src="dietary-filters.js"></script>
    <script src="culinary-extensions.js"></script>
    <script src="js/timers.js"></script>
    <script src="js/modal.js"></script>
    <script src="js/chat.js"></script>
    <script src="js/profile.js"></script>
    <script src="js/main.js"></script>

    <!-- Modal for adding custom ingredient -->
    <div class="modal-overlay" id="addCustomIngredientModal">
        <div class="modal-card">
            <div class="modal-header">
                <h3>–î–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–π –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç</h3>
                <button class="modal-close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="customIngredientName">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                    <input type="text" id="customIngredientName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, '–°—ã—Ä —Ñ–µ—Ç–∞'">
                </div>
                <div class="form-group">
                    <label for="customIngredientDescription">–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                    <textarea id="customIngredientDescription" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, '–°–æ–ª–µ–Ω—ã–π, –≤ —Ä–∞—Å—Å–æ–ª–µ'"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn secondary">–û—Ç–º–µ–Ω–∞</button>
                <button class="modal-btn primary">–î–æ–±–∞–≤–∏—Ç—å</button>
            </div>
        </div>
    </div>

</body>
</html>
